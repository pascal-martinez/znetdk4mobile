/*!
 * ZnetDK, Starter Web Application for rapid & easy development
 * See official website https://mobile.znetdk.fr/
 * Copyright (C) 2025 Pascal MARTINEZ (contact@znetdk.fr)
 * License GNU GPL http://www.gnu.org/licenses/gpl-3.0.html GNU GPL
 * --------------------------------------------------------------------
 * ZnetDK 4 Mobile JS library
 * File version: 3.4.0
 */var znetdkMobile={hideClass:'w3-hide',ajax:{requestContext:[],loaderElementId:"zdk-ajax-loading",requestInProgress:0,customAjaxUrl:null},authentication:{loginFormId:'#zdk-login-modal',urlLoginParamName:'login',changePasswordFormId:'#zdk-changepwd-modal',changePasswordView:'Z4MChangePwdCtrl',connectedUserPanelId:'#zdk-userpanel-modal',rememberMeLocalStorageKey:'znetdkmobile_authentication_remember_me',loginNameStorageKey:'znetdkmobile_authentication_login_name',loginWithEmailStorageKey:'znetdkmobile_authentication_login_with_email',myUserRightsModalId:'#mzdk-my-user-rights',myUserRightsViewName:'z4mmyuserrights',events:{}},browser:{confirmationOnApplicationClose:!0,disablingDelay:500,events:{}},header:{headerId:'#zdk-header',menuButtonId:'#zdk-side-nav-button',connectionAreaId:'#zdk-connection-area',autoHideOnScrollEnabled:!1,events:{}},navigation:{companyLogoId:'#zdk-company-logo',menuDefinitionId:'#zdk-custom-menu',verticalMenuId:'#zdk-side-nav-menu',horizontalMenuId:'#zdk-tab-menu',verticalMenuItemClasses:'w3-bar-item w3-button w3-leftbar',menuIconTemplate:'<i class="fa fa-lg fa-fw"></i>',autoReloadViewClass:'zdk-viewreload',events:{beforeViewDisplayName:'beforeviewdisplay',afterViewDisplayName:'afterviewdisplay'}},content:{containerId:'#zdk-content',defaultContainerId:'#default_content',events:{displayViewName:'displayview',topSpaceChangeName:'topspacechange'}},footer:{footerId:'#zdk-footer'},messages:{element:null,containerId:'#zdk-messages',messageTemplateId:'#zdk-message-tpl',snackbarTemplateId:'#zdk-snackbar-tpl',colors:{},icons:{info:'fa-info-circle',warn:'fa-warning',error:'fa-times-circle',critical:'fa-ban'},autoCloseDuration:6000,events:{}},log:{},serviceWorker:{isRegistered:!1},install:{installMessageId:'#zdk-install-message',installViewName:'z4minstall',installModalId:'#mzdk-userpanel-install',uninstallViewName:'z4muninstall',uninstallModalId:'#mzdk-userpanel-uninstall',isInstalledStorageKey:'znetdkmobile_install_ok',noInstallStorageKey:'znetdkmobile_install_no',installPrompt:null,events:{}},modal:{element:null,cssClass:'w3-modal',closeOnSubmitSuccess:!0,events:{beforeOpenName:'beforeshow',afterOpenName:'aftershow',beforeUiModalCloseNane:'beforeuimodalclose',beforeCloseName:'beforehide',afterCloseName:'afterhide'}},form:{element:null,inputData:null,inputInErrorClass:'z4m-form-invalid',messageTemplate:'<div class="w3-panel"><p><i class="icon fa"></i>&nbsp;&nbsp;<span class="msg"></span></p></div>',revealPwdIcon:'fa-eye',hidePwdIcon:'fa-eye-slash',remoteActions:{submit:{controller:null,action:null},load:{controller:null,action:null}},events:{afterSubmitSuccessName:'aftersubmitsuccess'}},action:{buttonTemplateId:'#zdk-action-tpl',buttonGap:60,buttons:{add:{id:'#zdk-mobile-action-add'},refresh:{id:'#zdk-mobile-action-refresh'},search:{id:'#zdk-mobile-action-search'},scrollup:{id:'#zdk-mobile-action-scrollup'}},views:{},events:{}},list:{element:null,rowTemplate:null,noRowMessage:'<li><h3>No row found!</h3></li>',nextRowsLinkTemplateId:'#zdk-show-next-rows-tpl',customSortCriteria:null,defaultCustomSortCriterium:null,rowsPerPage:20,heightDiffForNewPage:200,infiniteScroll:!0,displayRowCountInMenuTab:!0,isAutocompleteOnSearchEnabled:!1,uniqueSearchedKeyword:!1,searchedKeywordAsJson:!1,searchKeywordCaption:null,searchKeywordMinStringLengh:3,beforeSearchRequestCallback:null,beforeInsertRowCallback:null,afterInsertRowCallback:null,loadedCallback:null,searchModalId:'#zdk-searchinlist-modal',sortFieldStorageKey:'znetdkmobile_list_sort_field',sortOrderStorageKey:'znetdkmobile_list_sort_order',sortLabelStorageKey:'znetdkmobile_list_sort_label',keywordsStorageKey:'znetdkmobile_list_filter_keywords',remoteActions:{load:{controller:null,action:null},autocomplete:{controller:null,action:null}},events:{afterClickEditButtonName:'afterClickEdit',onContentScrollName:'onContentScroll',afterPageLoadedName:'afterpageloaded'}},autocomplete:{element:null,minStringLength:1,delay:300,maxNumberOfCachedItems:0,cacheLifetime:'page',listTemplateId:'#zdk-autocomplete-tpl',itemTemplateId:'#zdk-autocomplete-item-tpl',prevQueryString:null,itemCache:[],remoteActions:{autocomplete:{controller:null,action:null}}},file:{}};if(z4m===undefined){var z4m=znetdkMobile}(function($,z4m){$(document).ready(function(){if(z4m.isZnetDK4MobileApp()){z4m.initColors();z4m.initApp()}});z4m.isZnetDK4MobileApp=function(){return $('meta[name=generator][content^=ZnetDK]').length===1};z4m.initColors=function(){for(const color of['info','warn','error','critical','snackbar']){z4m.messages.colors[color]=$(z4m.messages.messageTemplateId).data(color)}
z4m.navigation.verticalMenuItemClasses+=' '+$(z4m.navigation.verticalMenuId).data('hover')+' '+$(z4m.navigation.verticalMenuId).data('borderSelect');z4m.navigation.activeMenuItemClass=$(z4m.navigation.verticalMenuId).data('select');z4m.navigation.activeMenuItemBorderClass=$(z4m.navigation.verticalMenuId).data('borderSelect');z4m.autocomplete.selectedItemCssClass=$(z4m.autocomplete.itemTemplateId).data('select')};z4m.initApp=function(){let isMenuBuilt;if(z4m.authentication.isRequired()){z4m.navigation.setNoNavigation();z4m.header.hideConnectionArea(!0);z4m.authentication.showLoginForm()}else{isMenuBuilt=z4m.navigation.build();if(z4m.authentication.isEnabled()){z4m.header.showConnectionArea();z4m.authentication.removeLoginParamFromUrl()}else{z4m.header.hideConnectionArea()}}
this.browser.events.handleViewportResize();this.modal.events.handleAllClose();this.form.events.handleAllInput();this.form.events.handleAllSubmit();this.browser.events.preventMultipleClicks();this.form.events.handleTogglePassword();this.messages.events.handleAllClose();this.action.events.handleClick();this.list.events.handleEdit();this.list.events.handleScroll();if(z4m.authentication.isEnabled()&&!z4m.authentication.isRequired()){this.header.events.handleProfileButtonClick();this.header.events.handleLogoutButtonClick()}
if(!z4m.authentication.isRequired()&&isMenuBuilt){this.install.events.handleBeforeInstallPrompt()}
this.serviceWorker.register()};z4m.ajax.getParamsFromAjaxURL=function(){if(this.customAjaxUrl!==null){return this.customAjaxUrl}
var requestUrl=$('body').data('ajaxurl'),URLArray=requestUrl.split("?"),paramArray=[],result={};result.url=URLArray[0];if(URLArray.length===2){paramArray=URLArray[1].split("=");result.paramName=paramArray[0];result.paramValue=paramArray[1]}
return result};z4m.ajax.setCustomAjaxURL=function(url,paramName,paramValue){this.customAjaxUrl={url:url};if(typeof paramName==='string'&&typeof paramValue==='string'){this.customAjaxUrl.paramName=paramName;this.customAjaxUrl.paramValue=paramValue}};z4m.ajax.toggleLoader=function(isVisible){const overlayId='zdkmobile-ajax-loading-overlay',loaderId=z4m.ajax.loaderElementId;if(isVisible){let loaderDef=$('body').data('ajaxloader'),loaderEl=$(loaderDef);loaderEl.attr('id',loaderId);$('body').append(loaderEl);$('body').append('<div id="'+overlayId+'"/>')}else{$('#'+loaderId).remove();$('#'+overlayId).remove()}};z4m.ajax.request=function(options){if(options.hasOwnProperty('controller')&&!options.hasOwnProperty('control')){options.control=options.controller}
if(options.control&&options.action){var ajaxURL=this.getParamsFromAjaxURL();var ajaxOptions={type:"POST",url:ajaxURL.url,beforeSend:function(){if(!z4m.ajax.requestInProgress){z4m.ajax.toggleLoader(!0)}
z4m.ajax.requestInProgress+=1},success:function(response){try{if(options.htmlTarget){options.htmlTarget.prepend(response);if(typeof options.callback==="function"){options.callback(response)}}else if(typeof response==="object"){if(typeof options.callback==="function"){options.callback(response)}else if(response.hasOwnProperty('msg')&&(response.hasOwnProperty('success')||response.hasOwnProperty('warning'))){var levelMsg=response.success===!1?'error':response.warning===!0?'warn':'info',summary=response.hasOwnProperty('summary')?response.summary:'Message';if(levelMsg!=='error'&&(!response.hasOwnProperty('summary')||response.summary===null||response.summary==='')){z4m.messages.showSnackbar(response.msg,levelMsg==='warn')}else{z4m.messages.add(levelMsg,summary,response.msg,!1)}}}else{z4m.messages.add('error','Message','Invalid Ajax response sent by the web server!',!1)}}catch(error){hideLoaderImage();z4m.navigation.closeVerticalMenu();z4m.messages.add('critical','OOPS!','A Javascript error occured while processing the AJAX request response! See your browser console for details.');z4m.log.error("JS error dectected while processing the response of the '"+options.control+':'+options.action+"' controller's action."+(typeof response==='object'?"\nResponse: "+JSON.stringify(response):'')+"\nJS error: "+(error.hasOwnProperty('stack')?error.stack:error.message));z4m.ajax.emptyRequestContext()}},error:function(response){var isDisconnected,errorMsg,errorSummary,appVersion,reloadSummary,reloadMsg,errorLevel=response.status===401?'warn':'critical';if(/application\/json/.test(response.getResponseHeader('Content-Type'))){try{let errorObject=JSON.parse(response.responseText);isDisconnected=errorObject.is_disconnected;errorMsg=errorObject.msg;errorSummary=errorObject.summary;appVersion=errorObject.appver;reloadSummary=errorObject.reload_summary;reloadMsg=errorObject.reload_msg}catch(e){}}
if(response.status===0){let msgArray=$('body').data('networkerrormsg').split("|");errorSummary=msgArray[0];errorMsg=msgArray[1];errorLevel='error'}else if(errorMsg===undefined){errorMsg="The JSON response returned by the controller='"+options.control+"' and the action='"+options.action+"' can't be parsed! HTTP status: "+response.status+' '+response.statusText;errorSummary='Error parsing server response'}
if(typeof options.errorCallback==="function"&&options.errorCallback(response)===!1){z4m.ajax.emptyRequestContext();return}
if(response.status===401&&isDisconnected===!1){z4m.messages.showSnackbar(errorMsg,!0);if(typeof appVersion==='number'&&typeof reloadSummary==='string'&&typeof reloadMsg==='string'&&parseInt($('body').data('appver'))<appVersion){reloadApp(reloadSummary,reloadMsg)}else{z4m.ajax.requestContext.push(options);if(z4m.ajax.requestContext.length===1){z4m.authentication.showLoginForm(!0)}}}else if(response.status===401&&isDisconnected===!0){reloadApp(errorSummary,errorMsg)}else{z4m.messages.add(errorLevel,errorSummary,errorMsg,!1);z4m.ajax.emptyRequestContext()}},complete:function(){hideLoaderImage()}};if(options.data&&options.data instanceof FormData){let requestData=options.data;requestData.append("control",options.control);requestData.append("action",options.action);if(ajaxURL.hasOwnProperty('paramName')){requestData.append(ajaxURL.paramName,ajaxURL.paramValue)}
ajaxOptions.data=requestData;ajaxOptions.processData=!1;ajaxOptions.contentType=!1}else if(options.data&&typeof options.data==="object"){let requestData;if(Array.isArray(options.data)){requestData='control='+options.control+'&action='+options.action+'&'+$.param(options.data)}else{var property;requestData='control='+options.control+'&action='+options.action;for(property in options.data){var value=options.data[property],encodedValue=typeof value==='string'?encodeURIComponent(value):value;if(typeof value!=='undefined'&&value!==null){requestData+='&'+property+'='+encodedValue}}}
if(ajaxURL.hasOwnProperty('paramName')){requestData+='&'+ajaxURL.paramName+'='+ajaxURL.paramValue}
ajaxOptions.data=requestData}else{ajaxOptions.data={control:options.control,action:options.action};if(ajaxURL.hasOwnProperty('paramName')){ajaxOptions.data[ajaxURL.paramName]=ajaxURL.paramValue}}
return $.ajax(addUITokenToAjaxOptions(ajaxOptions))}
z4m.log.error("Call to the request method failed, properties 'control' or 'action' are missing: ",options);return!1;function hideLoaderImage(){if(z4m.ajax.requestInProgress===1){z4m.ajax.toggleLoader(!1)}
z4m.ajax.requestInProgress-=1}
function reloadApp(summary,msg){z4m.messages.notify(summary,msg,'Ok',function(){z4m.browser.events.detachBeforeUnload();location.reload()})}
function addUITokenToAjaxOptions(ajaxOptions){const token=$('body').data('ui-token');if(token&&token.length>0){if(ajaxOptions.data instanceof FormData){ajaxOptions.data.append('uitk',token)}else if(typeof ajaxOptions.data==='string'){ajaxOptions.data+='&uitk='+token}else if(typeof ajaxOptions.data==='object'){ajaxOptions.data.uitk=token}}
return ajaxOptions}};z4m.ajax.loadView=function(viewName,targetHtmlElement,callback){var requestOptions={control:viewName,action:'show',htmlTarget:targetHtmlElement};if(typeof callback==='function'){requestOptions.callback=callback}
if(targetHtmlElement instanceof jQuery&&typeof viewName==='string'){return z4m.ajax.request(requestOptions)}
return!1};z4m.ajax.requestFromQueue=function(){var ajaxObject=z4m.ajax,queueSize=ajaxObject.requestContext.length;for(var index=0;index<queueSize;index++){if(index>=ajaxObject.requestContext.length){break}
ajaxObject.request(ajaxObject.requestContext[index])}
ajaxObject.requestContext.splice(0,queueSize)};z4m.ajax.emptyRequestContext=function(){z4m.ajax.requestContext=[]};z4m.ajax.initControllerActionProperties=function(type,object){if(type!=='load'&&type!=='submit'&&type!=='autocomplete'){z4m.log.error('The type of controller action is invalid!');return!1}
if(object===null||typeof object!=='object'){z4m.log.error('Not a JS object!');return!1}
if(!object.hasOwnProperty('element')){z4m.log.error("'element' property is missing!",object);return!1}
if(object.element instanceof jQuery===!1){z4m.log.error('Not a jQuery element!',object.element);return!1}
var actionAttrib=object.element.attr('data-zdk-'+type);if(typeof actionAttrib==='string'){var actionArray=actionAttrib.split(":");if(!object.hasOwnProperty('remoteActions')){object.remoteActions={}}
object.remoteActions[type]={controller:actionArray[0],action:actionArray[1]};return!0}else{return!1}};z4m.browser.addLabelToTitle=function(label){var separator=" | ";var newTitle=document.title;var sepIndex=newTitle.indexOf(separator);if(sepIndex===-1){newTitle=label===null||label===""?newTitle:label+separator+newTitle}else{newTitle=label===null||label===""?newTitle.substring(sepIndex+separator.length):label+separator+newTitle.substring(sepIndex+separator.length)}
document.title=newTitle};z4m.browser.getLocalDataKeyPath=function(){var params=z4m.ajax.getParamsFromAjaxURL(),url=params.url.replace('index.php','');if(params.hasOwnProperty('paramName')&&params.paramName==='appl'&&params.hasOwnProperty('paramValue')){url+=params.paramValue+'/'}
return url};z4m.browser.storeLocalData=function(storageKey,value){var path=this.getLocalDataKeyPath();try{localStorage.setItem(path+storageKey,value);return!0}catch(e){z4m.log.error('local storage not supported by the browser!');return!1}};z4m.browser.readLocalData=function(storageKey){var path=this.getLocalDataKeyPath();try{var storedValue=localStorage.getItem(path+storageKey);if(storedValue){return storedValue}else{return!1}}catch(e){z4m.log.error('local storage not supported by the browser!');return!1}};z4m.browser.removeLocalData=function(storageKey){var path=this.getLocalDataKeyPath();try{localStorage.removeItem(path+storageKey)}catch(e){z4m.log.error('local storage not supported by the browser!')}};z4m.browser.doPhoneCall=function(phoneNumber){var callablePhoneNbr=phoneNumber.replace(/\./g,'');document.location.replace('tel:'+callablePhoneNbr)};z4m.browser.sendSms=function(phoneNumber,message){var callablePhoneNbr=phoneNumber.replace(/\./g,'');document.location.replace('sms:'+callablePhoneNbr+';?&body='+encodeURIComponent(message.trim()))};z4m.browser.disableTemporarily=function(element){element.prop('disabled',!0);setTimeout(function(){element.prop('disabled',!1)},z4m.browser.disablingDelay)};z4m.browser.events.handleViewportResize=function(){$(window).on('resize.z4m',function(){z4m.content.setTopSpacing();z4m.action.adjustPosition()})};z4m.browser.events.handleBeforeUnload=function(){if(z4m.browser.confirmationOnApplicationClose&&!z4m.navigation.isPageToBeReloaded()&&!z4m.authentication.isRequired()){$(window).on('beforeunload.z4m',function(event){event.preventDefault();return(event.returnValue='')})}};z4m.browser.events.detachBeforeUnload=function(){$(window).off('beforeunload.z4m')};z4m.browser.events.preventMultipleClicks=function(){$('body').on('click.z4m-browser-prevent-multiple-clicks','a, button:not(:submit)',function(){z4m.browser.disableTemporarily($(this))})};z4m.header.getConnectionArea=function(){return $(this.connectionAreaId)};z4m.header.getConnectedUserLogin=function(){return this.getConnectionArea().data('zdk-login')};z4m.header.getConnectedUserName=function(){return this.getConnectionArea().data('zdk-username')};z4m.header.getConnectedUserMail=function(){return this.getConnectionArea().data('zdk-usermail')};z4m.header.getHeight=function(){return $(this.headerId).height()};z4m.header.getMenuButton=function(){return $(this.menuButtonId)};z4m.header.hideConnectionArea=function(isDisconnected){$(this.connectionAreaId).addClass(z4m.hideClass);$(this.headerId).find('.banner-title-small,.banner-title-large').addClass('no-connection');if(isDisconnected===!0){$(this.headerId).find('.banner-title-small,.banner-title-large').addClass('is-disconnected')}};z4m.header.showConnectionArea=function(){$(this.connectionAreaId).removeClass(z4m.hideClass);$(this.headerId).find('.banner-title-small,.banner-title-large').removeClass('no-connection')};z4m.header.isVisible=function(){return $(z4m.header.headerId).css('top')==='0px'};z4m.header.autoHideOnScroll=function(isEnabled){this.events.handleHideHeaderOnScroll(isEnabled)};z4m.header.events.handleProfileButtonClick=function(){$('#zdk-profile').on('click.z4m_header',function(event){z4m.authentication.showUserPanel();event.preventDefault()})};z4m.header.events.handleLogoutButtonClick=function(){$('#zdk-logout').on('click.z4m_header',function(event){z4m.authentication.disconnect();event.preventDefault()})};z4m.header.events.handleHideHeaderOnScroll=function(isEnabled){$(window).off('scroll.z4m_header');if(isEnabled===!1){z4m.header.autoHideOnScrollEnabled=!1;return}
z4m.header.autoHideOnScrollEnabled=!0;$(window).on('scroll.z4m_header',function(){if(document.body.scrollTop>40||document.documentElement.scrollTop>40){z4m.content.setTopSpacingToTargetAnchor();$(z4m.header.headerId).css('top',z4m.header.getHeight()*-1)}else{$(z4m.header.headerId).css('top',0)}})};z4m.content.getContainer=function(){return $(this.containerId)};z4m.content.getDefaultContainer=function(){return $(this.defaultContainerId)};z4m.content.showContainer=function(){this.getContainer().parent().removeClass(z4m.hideClass)};z4m.content.getPreloadedViewId=function(){var view=this.getContainer().find('.zdk-filled').eq(0);return this.getViewId(view)};z4m.content.getViewId=function(viewElement){if(viewElement.length===1){let splittedID=(viewElement.attr('id')).split('-');splittedID.splice(0,1);splittedID.splice(-1,1);return splittedID.join('-')}
return null};z4m.content.displayView=function(viewID,anchor){$('body').trigger(this.events.displayViewName,[viewID,anchor])};z4m.content.reloadView=function(viewID,anchor){$('body').trigger(this.events.displayViewName,[viewID,anchor,!0])};z4m.content.isDefaultContainerHidden=function(){return this.getDefaultContainer().hasClass('ui-helper-hidden')};z4m.content.setTopSpacing=function(){var headerHeight=z4m.header.getHeight(),originalHeight=parseFloat(this.getContainer().css('padding-top')),headerHeightHasChanged=headerHeight!==originalHeight;this.getContainer().css('padding-top',headerHeight);this.setTopSpacingToTargetAnchor();if(headerHeightHasChanged){$('body').trigger(this.events.topSpaceChangeName,[originalHeight,headerHeight])}};z4m.content.setTopSpacingToTargetAnchor=function(){var headerHeight=z4m.header.getHeight();if($('#zdk-anchor-adjust').length>0){$('#zdk-anchor-adjust').remove()}
if(z4m.header.autoHideOnScrollEnabled===!1){$('body').append('<style id="zdk-anchor-adjust">'+':target {'+'padding-top:'+headerHeight+'px;'+'margin-top:-'+headerHeight+'px;'+'display: inline-block;}'+'</style>')}};z4m.content.setHtml=function(html){this.getContainer().empty().html(html)};z4m.content.getDisplayedView=function(){return this.getContainer().find('.zdk-view:visible')};z4m.content.getDisplayedViewId=function(){var view=this.getDisplayedView();return this.getViewId(view)};z4m.content.getParentViewId=function(childElement){if(childElement instanceof jQuery===!1){z4m.log.error('The specified child element is not jQuery object!');return null}
var viewElement=childElement.closest('.zdk-view');return this.getViewId(viewElement)};z4m.content.doesViewExistInDom=function(viewId){var view=this.getContainer().find('#znetdk-'+viewId+'-view');return view.length===1};z4m.content.goToAnchor=function(anchor){if(anchor===undefined){anchor=location.hash;if(anchor.length===0){return!1}}else{anchor='#'+anchor}
if($(anchor).length!==1){return!1}
if(z4m.navigation.isPageToBeReloaded()){var tempLink=$('<a href="'+anchor+'"></a>').appendTo('body');tempLink[0].click();tempLink.remove()}else{var anchorPosition=$(anchor).offset().top,headerHeight=z4m.header.getHeight();$(window).scrollTop(anchorPosition-headerHeight)}
return!0};z4m.footer.hide=function(){$(this.footerId).addClass(z4m.hideClass)};z4m.footer.show=function(){$(this.footerId).removeClass(z4m.hideClass)};z4m.footer.adjustPosition=function(){this.show()};z4m.footer.getHeight=function(){var footerElement=$(this.footerId),footerHeight=footerElement.outerHeight(!0);if(footerHeight===0){footerElement.css('visibility','hidden');this.show();footerHeight=footerElement.outerHeight(!0);this.hide();footerElement.css('visibility','visible')}
return footerHeight};z4m.messages.getContainer=function(){return $(this.containerId)};z4m.messages.add=function(severity,summary,detail,autoHide){const newEl=$(this.messageTemplateId).contents().filter('div').clone();newEl.addClass(this.colors[severity]).find('.icon').addClass(this.icons[severity]);newEl.find('.summary').html(summary);newEl.find('.detail').html(detail);newEl.appendTo(this.getContainer());if(severity!=='critical'&&(autoHide===undefined||autoHide===!0)){window.setTimeout(function(){newEl.remove();z4m.content.setTopSpacing()},this.autoCloseDuration)}
z4m.content.setTopSpacing()};z4m.messages.addMulti=function(messages){if(!Array.isArray(messages)){z4m.log.error('Not an array!');return!1}
var $this=this;messages.forEach(function(message){if(Array.isArray(message)){$this.add.apply($this,message)}});return!0};z4m.messages.removeAll=function(){this.getContainer().empty();z4m.content.setTopSpacing()};z4m.messages.showSnackbar=function(text,isWarning,parentContainer){const newEl=$(this.snackbarTemplateId).contents().filter('div').clone();newEl.addClass(isWarning===!0?this.colors.warn:this.colors.snackbar);newEl.find('.icon').addClass(isWarning===!0?this.icons.warn:this.icons.info);newEl.find('.msg').html(text);newEl.appendTo(parentContainer===undefined?$('body'):parentContainer);window.setTimeout(function(){newEl.remove()},2500)};z4m.messages.notify=function(title,message,buttonLabel,callback){var modal=$('#zdk-notification-modal');modal.find('.title').html(title);modal.find('.message').html(message);if(typeof buttonLabel==='string'){modal.find('button').html(buttonLabel)}
modal.find('button').one('click.z4m_messages',function(){modal.hide();if(typeof callback==='function'){callback()}});modal.show()};z4m.messages.ask=function(title,question,buttons,callback){var modal=$('#zdk-confirmation-modal'),yesLabel,noLabel;modal.find('.title').html(title);modal.find('.message').html(question===null?modal.find('.message').data('default-msg'):question);if(buttons!==null&&typeof buttons==='object'&&buttons.hasOwnProperty('yes')&&buttons.hasOwnProperty('no')){yesLabel=buttons.yes;noLabel=buttons.no}else{yesLabel=modal.find('button.yes span.label').data('default-label');noLabel=modal.find('button.no span.label').data('default-label')}
modal.find('button.yes span.label').html(yesLabel);modal.find('button.no span.label').html(noLabel);modal.find('button').off('click.z4m_messages');modal.find('button').one('click.z4m_messages',function(){modal.hide();if(typeof callback==='function'){callback($(this).hasClass('yes'))}});modal.show();modal.find('button.no').trigger('focus')};z4m.messages.events.handleAllClose=function(){z4m.messages.getContainer().on('click.z4m_messages','a.close',function(event){$(this).parent().remove();z4m.content.setTopSpacing();event.preventDefault()})};z4m.log.warn=function(message,objectToLog,severity){var consoleMethod;if(severity==='error'){consoleMethod=console.error}else{consoleMethod=console.warn}
if(typeof objectToLog==='object'){consoleMethod('[z4m]',message,', Traced object:',objectToLog)}else{consoleMethod('[z4m]',message)}};z4m.log.error=function(message,objectToLog){this.warn(message,objectToLog,'error')};z4m.authentication.isEnabled=function(){var loginName=z4m.header.getConnectedUserLogin();return loginName!==''};z4m.authentication.isRequired=function(){return(z4m.navigation.getMenuDefinition().length===0&&z4m.content.isDefaultContainerHidden())};z4m.authentication.changePassword=function(login,oldPwd,msg){const $this=this,isUserConnected=msg===undefined;z4m.modal.make(this.changePasswordFormId,this.changePasswordView,function(){const modal=this,form=this.getInnerForm();form.init({login_name:login});if(oldPwd!==undefined){form.setInputValue('password',oldPwd)}
this.open(function(response){if(response.success){form.reset();modal.close();z4m.messages.showSnackbar(response.msg);if(!isUserConnected){setTimeout(function(){location.reload()},500)}
return!1}},function(){form.reset();if(!isUserConnected){$this.cancelLogin(modal);return!1}},isUserConnected?'password':'login_password');if(msg){form.showInfo(msg,!0)}})};z4m.authentication.showUserPanel=function(){var $this=this,modalElement=$(this.connectedUserPanelId),modal=z4m.modal.make(modalElement),userName=z4m.header.getConnectedUserName(),email=z4m.header.getConnectedUserMail();modalElement.find('h3.username').text(userName);modalElement.find('p.usermail').text(email);modal.open();_handleButtonClick('changepwd',function(){const isLoginNameEmail=z4m.browser.readLocalData(this.loginWithEmailStorageKey);this.changePassword(isLoginNameEmail==='1'?email:z4m.header.getConnectedUserLogin())});_handleButtonClick('myuserrights',function(){z4m.modal.make(this.myUserRightsModalId,this.myUserRightsViewName,function(){this.open()})});_handleButtonClick('install',function(){z4m.install.showInstallView()},!z4m.serviceWorker.isRegistered);_handleButtonClick('uninstall',function(){z4m.install.showUninstallView()},!z4m.serviceWorker.isRegistered);_handleButtonClick('logout',function(){this.disconnect()});function _handleButtonClick(buttonClass,onClick,isOnlyOff){var eventName='click.z4m_auth',button=modalElement.find('button.'+buttonClass);button.off(eventName);if(isOnlyOff===!0){return}
button.on(eventName,function(){modal.close();onClick.call($this)});button.removeClass(z4m.hideClass)}};z4m.authentication.showLoginForm=function(renewCredentials){var $this=this,modal=z4m.modal.make($(this.loginFormId)),focusedField=initLoginName();handleRememberMeClick();if(initRememberMeState()){handleForgotPasswordClick()}
modal.open(function(response){if(response.success===!0||response.newpasswordrequired){memorizeRememberMeState(response.login_with_email)}
if(response.success===!0){if(renewCredentials===!0){modal.close();z4m.ajax.requestFromQueue()}else{location.reload()}}
if(response.newpasswordrequired){modal.close();$this.changePassword(modal.getInnerForm().getInputValue('login_name'),modal.getInnerForm().getInputValue('password'),response.msg);return!1}else if(response.toomuchattempts){modal.getInnerForm(!0).find('button[type=submit]').prop('disabled',!0)}},function(){$this.cancelLogin(modal);return!1},focusedField);function initLoginName(){const login=getDefaultLoginName();if(login!==null){modal.getInnerForm().setInputValue('login_name',login);return'password'}
function getDefaultLoginName(){const urlLogin=new URL(window.location.toLocaleString()).searchParams.get($this.urlLoginParamName);if(isOK(urlLogin)){return urlLogin}
const userLogin=z4m.header.getConnectedUserLogin();if(isOK(userLogin)){return userLogin}
const localLogin=z4m.browser.readLocalData($this.loginNameStorageKey);return isOK(localLogin)?localLogin:null;function isOK(val){return typeof val==='string'&&val.length>0}}}
function handleRememberMeClick(){$('#zdk-login-modal-remember-me').off('change.z4m').on('change.z4m',function(){var accessElement=$(this).closest('form').find('input[name=access]'),accessValue=$(this).is(':checked')?'private':'public';accessElement.val(accessValue)})}
function initRememberMeState(){var accessValue=z4m.browser.readLocalData($this.rememberMeLocalStorageKey),rememberMeElement=$('#zdk-login-modal-remember-me');if(rememberMeElement.length===1&&accessValue!==!1){var accessElement=modal.getInnerForm(!0).find('input[name=access]');accessElement.val(accessValue);rememberMeElement.prop('checked',accessValue==='private')}
return accessValue!==!1}
function memorizeRememberMeState(loginWithEmail){var accessValue=modal.getInnerForm().getInputValue('access');z4m.browser.storeLocalData($this.rememberMeLocalStorageKey,accessValue);if(accessValue==='private'){let loginName=modal.getInnerForm().getInputValue('login_name');z4m.browser.storeLocalData($this.loginNameStorageKey,loginName)}else{z4m.browser.removeLocalData($this.loginNameStorageKey)}
z4m.browser.storeLocalData($this.loginWithEmailStorageKey,loginWithEmail)}
function handleForgotPasswordClick(){modal.getInnerForm(!0).find('.zdk-forgot-pwd').off('click.z4m').one('click.z4m',function(event){z4m.ajax.loadView('forgotpassword',$('body'),function(){modal.close();var resetPwdModal=z4m.modal.make('#mzdk_forgot_password_dialog');resetPwdModal.open(onSubmit,onCloseModal);function onSubmit(response){resetPwdModal.close();z4m.messages.notify(response.summary,response.msg,null,function(){$this.cancelLogin(modal)});return!1}
function onCloseModal(){$this.cancelLogin(modal)}});event.preventDefault()}).removeClass(z4m.hideClass)}};z4m.authentication.removeLoginParamFromUrl=function(){const url=new URL(document.location.href);const params=new URLSearchParams(url.search);params.delete(this.urlLoginParamName);url.search=params.toString();history.replaceState({},'',url.toString())};z4m.authentication.disconnect=function(){var $this=this;z4m.ajax.request({control:'security',action:'logout',callback:function(response){$this.setNoConnectionState(response.msg);z4m.browser.events.detachBeforeUnload()}})};z4m.authentication.cancelLogin=function(modal){var $this=this;z4m.ajax.request({control:'security',action:'cancellogin',callback:function(response){$this.setNoConnectionState(response.msg);modal.close()}})};z4m.authentication.setNoConnectionState=function(message){z4m.header.hideConnectionArea(!0);z4m.install.hideInstallableMessage();z4m.messages.removeAll();z4m.navigation.setNoNavigation();z4m.content.setTopSpacing();z4m.action.hide();z4m.content.setHtml(message);z4m.content.showContainer()};z4m.navigation.getMenuDefinition=function(){return $(this.menuDefinitionId)};z4m.navigation.getVerticalMenu=function(){return $(this.verticalMenuId)};z4m.navigation.getHorizontalMenu=function(){return $(this.horizontalMenuId)};z4m.navigation.getVerticalMenuWidth=function(){return this.getMenuDefinition().width()};z4m.navigation.getMenuItemId=function(menuElement){if(menuElement instanceof jQuery&&menuElement.length===1){var splittedID=(menuElement.attr('id')).split("-"),menuItemId='';for(var i=1;i<splittedID.length-1;i++){menuItemId+=(menuItemId.length>0?'-':'')+splittedID[i]}
return menuItemId}
return null};z4m.navigation.getFirstChildMenuItemId=function(parent){function _getFirstChildMenuItem(parent){if(parent===undefined){parent=$this.getMenuDefinition().find('ul > li').first()}
if(parent.length){var child=parent.find('ul>li').first();if(child.length){return _getFirstChildMenuItem(child)}else{return parent}}else{return!1}}
var $this=this,item=_getFirstChildMenuItem(parent);if(item===!1){return!1}
return this.getMenuItemId(item)};z4m.navigation.build=function(){var $this=this;_hideSubItems();_addW3cssClassesToMenu();_displayMenuIcons();_showMenu();z4m.content.showContainer();if(_displayInitialView()===!1){z4m.content.setTopSpacing();return!1}
_bindEvents();return!0;function _hideSubItems(){$this.getMenuDefinition().find('li.has-sub > ul').hide()}
function _addW3cssClassesToMenu(){$this.getMenuDefinition().find('a').addClass($this.verticalMenuItemClasses)}
function _displayMenuIcons(){$this.getMenuDefinition().find('li > a').each(function(){var icon=$(this).data('icon');if(typeof icon==='string'){const iconEl=$($this.menuIconTemplate);iconEl.addClass(icon);$(this).prepend(iconEl)}})}
function _showMenu(){$this.getMenuDefinition().css('display','block')}
function _bindEvents(){z4m.header.getMenuButton().on('click.z4m',function(event){$this.openVerticalMenu();event.preventDefault()});$this.getVerticalMenu().find('button.close').on('click.z4m',function(){$this.closeVerticalMenu()});$($this.companyLogoId).on('click.z4m',function(event){if(!$this.isPageToBeReloaded()){_displayInitialView();event.preventDefault()}});$this.getMenuDefinition().on('click.z4m_navigation','a',function(event){var menuItemId=$(this).next('ul').length===0?$this.getMenuItemId($(this).parent()):$this.getFirstChildMenuItemId($(this).parent());_displayView(menuItemId);event.preventDefault()});$this.getHorizontalMenu().on('click.z4m_navigation','a',function(event){var menuItemId=$(this).data('view_id');_displayView(menuItemId);event.preventDefault()});$('body').on('displayview.z4m_navigation',function(event,viewID,anchor,reload){_displayView(viewID,anchor,reload)})}
function _displayInitialView(){if($this.getMenuDefinition().length===0){return!1}
if($this.isPageToBeReloaded()){_displayPreloadedView()}else{_displayView()}
function _displayPreloadedView(){var innerViewId=z4m.content.getPreloadedViewId(),item=_getMenuItem(innerViewId),itemId=$this.getMenuItemId(item);if(innerViewId!==itemId){innerViewId=itemId}
if(_initHorizontalMenu(item)===!1){return!1}
_setVerticalMenuItemActive(innerViewId);_setHorizontalItemActive(innerViewId);z4m.content.setTopSpacing();z4m.content.goToAnchor()}}
function _displayView(viewID,anchor,reload){var noViewSpecified=viewID===undefined,menuItemId=noViewSpecified?$this.getFirstChildMenuItemId():viewID,containerID=_getViewContainerID(menuItemId),containerElement=$('#'+containerID),containerExists=(containerElement.length>0),menuItemElement=_getMenuItem(menuItemId);if(menuItemElement===!1){z4m.log.error("The view ID = '"+viewID+"' is unknown!");return!1}
if($this.isPageToBeReloaded()){var uriAnchor=anchor===undefined?'':'#'+anchor;location.assign(menuItemElement.children('a').first().attr('href')+uriAnchor);return}
if(!noViewSpecified){z4m.install.hideInstallableMessage()}
if(containerExists&&(reload===!0||containerElement.find('.'+$this.autoReloadViewClass).length===1)){containerElement.remove();containerExists=!1}
if(containerExists){_showView(menuItemId,anchor)}else{containerElement=$('<div id="'+containerID+'" class="zdk-view"/>');_getViewsContainer().prepend(containerElement);containerElement.hide();z4m.ajax.loadView(menuItemId,containerElement,function(){_showView(menuItemId,anchor)})}
function _showView(viewID,anchor){var viewElement=$('#'+_getViewContainerID(viewID)),viewIsVisible=viewElement.is(':visible'),displayedView=_getViewsContainer().children(".zdk-view").filter(":visible");$this.events.triggerBeforeViewDisplay(viewID);if(!viewIsVisible&&displayedView.length>=1){displayedView.fadeOut(200);displayedView.promise().done(function(){showObj()})}else{showObj()}
function showObj(){_initHorizontalMenu(_getMenuItem(viewID));_setHorizontalItemActive(viewID);_setVerticalMenuItemActive(viewID);z4m.browser.addLabelToTitle(_getMenuItemLabel(menuItemId));z4m.form.events.handleAllInvalid(viewElement.find('form'));if(!viewIsVisible){viewElement.fadeIn(200,function(){$this.events.triggerAfterViewDisplay(viewID);z4m.content.goToAnchor(anchor)})}else{$this.events.triggerAfterViewDisplay(viewID);z4m.content.goToAnchor(anchor)}
function _getMenuItemLabel(viewID){return _getMenuItem(viewID).children("a").text()}}}}
function _initHorizontalMenu(verticalMenuItem){if(verticalMenuItem===!1){return!1}
if(_isRootMenuItem(verticalMenuItem)){_addItemToHorizontalMenu(verticalMenuItem,!0)}else{_addSubItemsToHorizontalMenu(verticalMenuItem.parent('ul'))}
z4m.content.setTopSpacing();return!0;function _isRootMenuItem(menuElement){var rootItem=_getRootMenuItem(menuElement);return rootItem===menuElement}}
function _getRootMenuItem(menuElement){var result=menuElement;menuElement.parentsUntil($this.getMenuDefinition()).filter('li').each(function(){if($(this).parentsUntil($this.getMenuDefinition()).filter('li').length===0){result=$(this);return!1}});return result}
function _getMenuItem(viewID){var menuItem=$this.getMenuDefinition().find('ul > li[id=znetdk-'+viewID+'-menu]');if(menuItem.length===0){menuItem=$this.getMenuDefinition().find('ul > li.is-selected')}
return menuItem.length===1?menuItem:!1}
function _setVerticalMenuItemActive(viewID){var menuItem=_getMenuItem(viewID);_resetMenuItemActive();_getRootMenuItem(menuItem).addClass($this.activeMenuItemClass).addClass('is-active');function _resetMenuItemActive(){$this.getMenuDefinition().find('li.'+$this.activeMenuItemClass).removeClass($this.activeMenuItemClass).removeClass('is-active')}}
function _setHorizontalItemActive(viewID){var menuItem=null;if(viewID===undefined){menuItem=$this.getHorizontalMenu().find('.items a:first')}else{_resetTabItemActive();menuItem=$this.getHorizontalMenu().find('.items a[data-view_id='+viewID+']');if(menuItem.length===0){z4m.log.error("Horizontal tab menu: view ID='"+viewID+"' unknown.")}}
menuItem.addClass($this.activeMenuItemClass).addClass('is-active');function _resetTabItemActive(){$this.getHorizontalMenu().find('.items .menu-item').removeClass($this.activeMenuItemClass).removeClass('is-active')}}
function _addItemToHorizontalMenu(menuItem,onlyOne){var tabmenu=$this.getHorizontalMenu(),link=menuItem.children('a'),icon=link.data('icon'),label=link.text(),newItem=tabmenu.find('template').contents().filter('a').clone();if(icon===undefined){newItem.find('i').remove()}else{newItem.find('i').addClass(icon)}
if($this.isPageToBeReloaded){newItem.attr('href',link.attr('href'))}
newItem.find('span').text(label);newItem.attr('data-view_id',$this.getMenuItemId(menuItem));if(onlyOne===!0){tabmenu.find('.items').empty()}
tabmenu.find('.items').append(newItem)}
function _addSubItemsToHorizontalMenu(parentItem){var tabmenu=$this.getHorizontalMenu();tabmenu.find('.items').empty();parentItem.find('>li').each(function(){_addItemToHorizontalMenu($(this))})}
function _getViewContainerID(viewID){return'znetdk-'+viewID+'-view'}
function _getViewsContainer(){var container=z4m.content.getContainer();return container.length?container:$('body')}};z4m.navigation.isPageToBeReloaded=function(){return z4m.navigation.getMenuDefinition().hasClass('zdk-pagereload')};z4m.navigation.setNoNavigation=function(){$('main').css('margin-left','0');this.getVerticalMenu().css('visibility','hidden');this.getHorizontalMenu().css('visibility','hidden');z4m.header.getMenuButton().css('visibility','hidden')};z4m.navigation.openVerticalMenu=function(){this.getVerticalMenu().show()};z4m.navigation.closeVerticalMenu=function(){this.getVerticalMenu().hide()};z4m.navigation.addRowCountToHorizontalMenuItem=function(rowCount,viewId){var menuItem=this.getHorizontalMenu().find('.items a[data-view_id='+viewId+']');if(menuItem.length===0){z4m.log.error('Unable to get the horizontal menu item for the displayed view!');return!1}
if(menuItem.find('span.row-count').length===0){menuItem.find('span').last().after('<span class="row-count"/>')}
menuItem.find('span.row-count').text(' ('+rowCount+')');z4m.content.setTopSpacing();return!0};z4m.navigation.clearRowCountFromHorizontalMenuItem=function(viewId){var menuItem=this.getHorizontalMenu().find('.items a[data-view_id='+viewId+']');if(menuItem.length===0){z4m.log.error('Unable to get the horizontal menu item for the displayed view!');return!1}
menuItem.find('span.row-count').remove();z4m.content.setTopSpacing();return!0};z4m.navigation.events.triggerBeforeViewDisplay=function(viewId){z4m.action.hide();z4m.content.setTopSpacing();$('body').trigger(z4m.navigation.events.beforeViewDisplayName,[viewId])};z4m.navigation.events.triggerAfterViewDisplay=function(viewId){z4m.navigation.closeVerticalMenu();z4m.action.adjustPosition();$('body').trigger(z4m.navigation.events.afterViewDisplayName,[viewId])};z4m.modal.make=function(modalElementSelector,viewName,onViewLoaded){var modalElement=modalElementSelector instanceof jQuery?modalElementSelector:$(modalElementSelector);if(typeof modalElementSelector==='string'&&modalElement.length===0&&typeof viewName==='string'&&viewName.length>0&&typeof onViewLoaded==='function'){z4m.ajax.loadView(viewName,$('body'),function(){onViewLoaded.call(getNewObject($(modalElementSelector)))});return null}
if(modalElement.length!==1){z4m.log.error('Modal element is empty or multiple!');return null}
if(!modalElement.hasClass(this.cssClass)){z4m.log.error('Modal CSS class missing!',modalElement);return null}
if(typeof onViewLoaded==='function'){onViewLoaded.call(getNewObject(modalElement));return null}
return getNewObject(modalElement);function getNewObject(modalElement){var modalObject=Object.create(z4m.modal);modalObject.element=modalElement;z4m.form.events.handleAllInvalid(modalElement.find('form'));return modalObject}};z4m.modal.getInnerForm=function(asJqueryElement,selectorClass){var form=this.element.find('form'+(typeof selectorClass==='string'?'.'+selectorClass:''));if(form.length===0){return!1}else if(form.length>1){form=form.first()}
return asJqueryElement===!0?form:z4m.form.make(form)};z4m.modal.open=function(onSubmit,onClose,focusedInputName){if(this.element instanceof jQuery===!1){z4m.log.error('Modal is not instantiated!');return!1}
if(this.element.triggerHandler(this.events.beforeOpenName,[this])===!1){return!1}
_registerCloseCallback(this,onClose);this.element.show();_initForm(this,onSubmit);this.element.trigger(this.events.afterOpenName,[this]);return!0;function _registerCloseCallback(modalObject,closeCallback){if(typeof closeCallback!=='function'){return!1}
var eventName=modalObject.events.beforeUiModalCloseNane+'.z4m_modal';modalObject.element.off(eventName);modalObject.element.on(eventName,function(){return closeCallback()})}
function _initForm(modalObject,submitCallback){var form=modalObject.getInnerForm(!0);if(form===!1){return!1}
var formObject=z4m.form.make(form,function(response){var returnedValue=typeof submitCallback==='function'?submitCallback(response):!0;if(returnedValue!==!1&&response.success===!0&&modalObject.closeOnSubmitSuccess===!0){modalObject.close()}
return returnedValue});if(formObject.doesInputExist(focusedInputName)){formObject.setFocus(focusedInputName)}else{formObject.setFocusOnFirstInput()}}};z4m.modal.close=function(checkDataFormsModified){if(this.element instanceof jQuery===!1){z4m.log.error('Modal is not instantiated!');return!1}
if(this.element.triggerHandler(this.events.beforeCloseName,[this])===!1){return!1}
var modalElement=this.element,$this=this;_areDataFormsModified(function(){modalElement.hide();modalElement.trigger(z4m.modal.events.afterCloseName,[$this])});return!0;function _areDataFormsModified(callback){if(checkDataFormsModified===!1||checkDataFormsModified===undefined){return callback()}
var isModified=!1;modalElement.find('form[data-zdk-submit]').each(function(){var formObject=z4m.form.make($(this));if(formObject.isModified()){isModified=!0;return!1}});if(!isModified){return callback()}
z4m.messages.ask(modalElement.find('button.cancel').text(),null,null,function(isYes){if(isYes){callback()}})}};z4m.modal.setTitle=function(title){if(this.element instanceof jQuery===!1){z4m.log.error('Modal is not instantiated!');return!1}
var titleElement=this.element.find('header .title');if(titleElement.length===1){titleElement.html(title);return!0}
return!1};z4m.modal.events.handleAllClose=function(){var modalClass='.'+z4m.modal.cssClass,selector=modalClass+' span.close, '+modalClass+' a.close, '+modalClass+' button.cancel';$('body').on('click.z4m_modal',selector,function(){var modalObject=z4m.modal.make($(this).closest(modalClass));if(modalObject!==null&&modalObject.events.triggerBeforeClose.call(modalObject)!==!1){modalObject.close(!0)}});$(document).on('keydown.z4m_modal',function(event){let modalEl=event.target.closest('.'+z4m.modal.cssClass);modalEl=modalEl===null?$('.'+z4m.modal.cssClass+':visible'):$(modalEl);if(modalEl.length===1&&event.key==='Escape'){modalEl.find('header .close').trigger('click')}})};z4m.modal.events.triggerBeforeClose=function(){if(this.element instanceof jQuery===!1){z4m.log.error('Modal is not instantiated!');return null}
var status=this.element.triggerHandler(this.events.beforeUiModalCloseNane);return status!==!1};z4m.form.make=function(formElementSelector,submitCallback){var formElement=formElementSelector instanceof jQuery?formElementSelector:$(formElementSelector);if(formElement.length!==1){z4m.log.error('Form element is empty or multiple!');return null}
if(!formElement.is('form')){z4m.log.error('Not a form element!',formElement);return null}
var formObject=Object.create(this);formObject.element=formElement;z4m.ajax.initControllerActionProperties('submit',formObject);z4m.ajax.initControllerActionProperties('load',formObject);formObject.inputData=new FormData(formElement[0]);_registerSubmitCallback(submitCallback);return formObject;function _registerSubmitCallback(submitCallback){if(typeof submitCallback!=='function'){return!1}
var eventName=formObject.events.afterSubmitSuccessName+'.z4m_form';formElement.off(eventName);formElement.on(eventName,function(event,response){return submitCallback(response)})}};z4m.form.isInstance=function(){if(this.element instanceof jQuery===!1){z4m.log.error('Form is not instantiated!');return!1}
return!0};z4m.form.setFocusOnFirstInput=function(){if(!this.isInstance())return!1;var selector='textarea:visible:not([disabled]):not([readonly])'+',select:visible:not([disabled]):not([readonly])'+',input:visible:not([disabled]):not([readonly])',focusedElement=this.element.find(selector).first();if(focusedElement.length===1){focusedElement.trigger('focus');return!0}
return!1};z4m.form.setFocus=function(inputName){if(!this.isInstance())return!1;if(typeof inputName==='string'){var focusedElement=this.element.find('[name="'+inputName+'"]');if(focusedElement.length>0){focusedElement.focus().select();return!0}}
return!1};z4m.form.setDataModifiedState=function(isModified){if(!this.isInstance())return!1;if(typeof isModified!=='boolean'){return!1}
this.element.data('is-modified',isModified?'y':'n');if(isModified){z4m.browser.events.handleBeforeUnload()}else{z4m.browser.events.detachBeforeUnload()}
return!0};z4m.form.isModified=function(){if(!this.isInstance())return!1;return this.element.data('is-modified')==='y'};z4m.form.reset=function(){if(!this.isInstance())return!1;this.hideError();this.hideInfo();this.element[0].reset();this.element.find('input[type=hidden]').val('');this.setDataModifiedState(!1);return!0};z4m.form.init=function(valueObject,isFormResetBefore){if(valueObject===null||typeof valueObject!=='object'){z4m.log.error('Not a value object!');return!1}
if(Object.keys(valueObject).length===0){z4m.log.error('The value object is empty!');return!1}
if(!this.isInstance())return!1;if(isFormResetBefore===undefined||isFormResetBefore===!0){this.reset()}
for(var inputName in valueObject){this.setInputValue(inputName,valueObject[inputName],!0)}
return!0};z4m.form.load=function(id,callback){if(!this.isInstance())return!1;if(!this.hasOwnProperty('remoteActions')||!this.remoteActions.hasOwnProperty('load')||!this.remoteActions.load.hasOwnProperty('controller')||!this.remoteActions.load.hasOwnProperty('action')||typeof this.remoteActions.load.controller!=='string'||typeof this.remoteActions.load.action!=='string'){z4m.log.error('The data loading controller action is not properly set!');return!1}
var $this=this;z4m.ajax.request({control:this.remoteActions.load.controller,action:this.remoteActions.load.action,data:{id:id},callback:function(response){if($this.init(response)&&typeof callback==='function'){callback(response)}}});return!0};z4m.form.showInfo=function(msg,isWarn,hidePrevInfos){if(!this.isInstance())return!1;if(hidePrevInfos===!0){this.hideInfo()}
const newEl=$(this.messageTemplate);newEl.addClass(isWarn?['z4m-warn',z4m.messages.colors.warn]:['z4m-info',z4m.messages.colors.info]);newEl.find('.icon').addClass(isWarn?z4m.messages.icons.warn:z4m.messages.icons.info);newEl.find('.msg').html(msg);this.element.prepend(newEl);this.element[0].scrollIntoView();return!0};z4m.form.hideInfo=function(){if(!this.isInstance())return!1;this.element.find('div.z4m-info, div.z4m-warn').remove();return!0};z4m.form.showError=function(message,inputName,hidePrevErrors){if(!this.isInstance())return!1;if(hidePrevErrors===!0){this.hideError()}
let inputFound=[],pos;if(typeof inputName==='string'){const withPos=inputName.split(':',2);pos=withPos.length===2&&!isNaN(parseInt(withPos[1],10))?parseInt(withPos[1],10):null;inputFound=this.element.find('[name="'+withPos[0]+'"]')}
if(inputFound.length>0){if(pos===null){this.setFocus(inputName)}else{inputFound=inputFound.eq(pos);inputFound.focus().select()}
this.setLastInputInError(inputFound,message)}else{const newEl=$(this.messageTemplate);newEl.addClass(['alert',z4m.messages.colors.error]);newEl.find('.icon').addClass(z4m.messages.icons.error);newEl.find('.msg').html(message);this.element.prepend(newEl);this.element[0].scrollIntoView()}
return!0};z4m.form.hideError=function(){if(!this.isInstance())return!1;this.unsetLastInputInError();this.element.find('div.alert').remove();return!0};z4m.form.setLastInputInError=function(inputEl,errorMessage){if(!this.isInstance())return!1;if(inputEl instanceof jQuery===!1){z4m.log.error('Specified input element is invalid!');return!1}
if(this.getLastInputInError()!==null){return!1}
var $this=this;inputEl.addClass(z4m.form.inputInErrorClass);if(typeof errorMessage==='string'&&errorMessage.length>0){inputEl[0].setCustomValidity(getHtmlAsText(errorMessage));inputEl[0].reportValidity()}
this.element.on('change.z4m_form_showerror',function(){$this.unsetLastInputInError()});return!0;function getHtmlAsText(html){var pureText=html.replace('<br>',"\n"),tempDiv=$('<div/>');tempDiv.html(pureText);return tempDiv.text()}};z4m.form.getLastInputInError=function(){if(!this.isInstance())return!1;var lastInputInError=this.element.find('.'+z4m.form.inputInErrorClass);if(lastInputInError.length>0){return lastInputInError}
return null};z4m.form.unsetLastInputInError=function(){if(!this.isInstance())return!1;var lastInputInError=this.getLastInputInError();if(lastInputInError instanceof jQuery){lastInputInError[0].setCustomValidity('');lastInputInError.removeClass(z4m.form.inputInErrorClass);this.element.off('change.z4m_form_showerror')}
return!0};z4m.form.doesInputExist=function(inputName){if(!this.isInstance())return!1;return typeof inputName==='string'&&this.element.find('[name="'+inputName+'"]').length>0};z4m.form.getInputValue=function(inputName){if(!this.isInstance())return!1;if(typeof inputName!=='string'){z4m.log.error('String type expected for the inputName parameter!');return!1}
var inputElement=this.element.find('[name="'+inputName+'"]');if(inputElement.length===0){z4m.log.error("No input found with name='"+inputName+"'!");return!1}
if(inputElement.is('input')){if(inputElement.length===1){var inputTypes=['text','color','date','datetime-local','email','hidden','month','number','password','range','search','tel','time','url','week'],currentInputType=inputElement.attr('type');if(currentInputType===undefined||inputTypes.indexOf(currentInputType)!==-1){return inputElement.val()}else if(currentInputType==='checkbox'){return inputElement.is(':checked')?inputElement.val():''}
z4m.log.error("The input type='"+currentInputType+"' is not supported!");return!1}else{let radioValueFound=null,radioButtonCount=0,checkedBoxes=[],firstInputType=null;inputElement.each(function(){firstInputType=firstInputType===null?$(this).attr('type'):firstInputType;if($(this).attr('type')==='radio'&&$(this).prop('checked')===!0){radioValueFound=$(this).val();return!1}
if($(this).attr('type')==='checkbox'&&$(this).prop('checked')===!0){checkedBoxes.push($(this).val())}
if($(this).attr('type')==='radio'){radioButtonCount++}});if(firstInputType==='radio'&&radioValueFound!==null){return radioValueFound}else if(firstInputType==='radio'&&inputElement.length===radioButtonCount){return radioValueFound}else if(firstInputType==='checkbox'){return checkedBoxes}
z4m.log.error("The multiple input element with name='"+inputName+"' is not supported!");return!1}}
if(inputElement.is('select')){if(inputElement.prop('multiple')){let selectedItems=[];inputElement.find('option:selected').each(function(){selectedItems.push($(this).val())});return selectedItems}
return inputElement.val()}
if(inputElement.is('textarea')){return inputElement.val()}
z4m.log.error("The input with name='"+inputName+"' is not supported!");return!1};z4m.form.setInputValue=function(inputName,inputValue,silent){if(!this.isInstance())return!1;if(typeof inputName!=='string'){z4m.log.error('The input name must be a string!');return!1}
var inputElement=this.element.find('[name="'+inputName+'"]');if(inputElement.length===0){if(silent!==!0){z4m.log.error("No element found in the DOM with the name '"+inputName+"'!")}
return!1}
if(inputElement.is('input')&&(inputElement.attr('type')==='radio'||inputElement.attr('type')==='checkbox')){if(inputValue===''){return!1}
var checkedElement=inputElement.filter('[value="'+inputValue+'"]');if(checkedElement.length===1){checkedElement.prop('checked',!0);return!0}
if(inputElement.attr('type')==='radio'){z4m.log.error("The input element of type '"+inputElement.attr('type')+"' and named '"+inputName+"' does not exist with the value='"+inputValue+"'!");return!1}
inputElement.prop('checked',!1);if(Array.isArray(inputValue)&&inputValue.length>0){$.each(inputValue,function(){var selectedInput=inputElement.filter('[value="'+this+'"]');if(selectedInput.length===1){selectedInput.prop('checked',!0)}})}
return!0}else if(inputElement.is('select')&&inputElement.prop('multiple')===!0){if(!Array.isArray(inputValue)){if(silent!==!0){z4m.log.error("The value for the multiple select element with name='"+inputName+"' must be an array!",inputValue)}
return!1}
$.each(inputValue,function(){var selectedOption=inputElement.find('option[value="'+this+'"]');if(selectedOption.length===1){selectedOption.prop('selected',!0)}});inputElement.scrollTop(0);return!0}else{inputElement.val(inputValue);return!0}};z4m.form.setReadOnly=function(isReadOnly){if(!this.isInstance())return!1;var readOnlyState=isReadOnly===undefined||isReadOnly===!0;this.element.find('input:not([type=hidden],[type=radio],[type=checkbox]), textarea').each(function(){$(this).prop('readonly',readOnlyState)});this.element.find('select, input[type=radio],input[type=checkbox]').each(function(){$(this).prop('disabled',readOnlyState)});this.element.find('button[type=submit], input[type=submit]').prop('disabled',readOnlyState)};z4m.form.events.handleAllInput=function(){$('body').on('input.z4m_form_submit','form[data-zdk-submit]',function(event){if($(event.target).is(':input')){var formElement=$(this),formObject=z4m.form.make(formElement);formObject.setDataModifiedState(!0)}})};z4m.form.events.handleAllInvalid=function(formElement){if(formElement instanceof jQuery===!1){z4m.log.error('Form is not a jQuery object!');return!1}
var eventName='invalid.z4m_form_invalid';formElement.find(':input').off(eventName).on(eventName,function(){let formElement=$(this).closest('form'),formObject=z4m.form.make(formElement);formObject.setLastInputInError($(this))});return!0};z4m.form.events.handleAllSubmit=function(){$('body').on('submit.z4m_form_submit','form[data-zdk-submit]',function(event){if('submitter' in event.originalEvent){z4m.browser.disableTemporarily($(event.originalEvent.submitter))}
var formElement=$(this),formObject=z4m.form.make(formElement);z4m.ajax.request({control:formObject.remoteActions.submit.controller,action:formObject.remoteActions.submit.action,data:formObject.inputData,callback:function(response){formObject.hideError();if(formObject.events.triggerAfterSubmitSuccess.call(formObject,response)===!1){return!1}
if(response.success===!1){formObject.showError(response.msg,response.ename)}else if(response.hasOwnProperty('msg')&&response.hasOwnProperty('summary')){var severity=response.hasOwnProperty('success')&&response.success?'info':'error';if(response.hasOwnProperty('warning')&&response.warning){severity='warn'}
if(response.summary===null){z4m.messages.showSnackbar(response.msg,response.warning)}else{z4m.messages.add(severity,response.summary,response.msg)}}},errorCallback:function(response){if(response.hasOwnProperty('status')&&response.hasOwnProperty('responseJSON')&&response.responseJSON.hasOwnProperty('msg')){const error=(response.responseJSON.hasOwnProperty('summary')?'<b>'+response.responseJSON.summary+'</b><br>':'')+response.responseJSON.msg;formObject.showError(error,null,!0);return!1}
return!0}});event.preventDefault()})};z4m.form.events.triggerAfterSubmitSuccess=function(response){if(this.element instanceof jQuery===!1){z4m.log.error('Form is not instantiated!');return null}
var status=this.element.triggerHandler(this.events.afterSubmitSuccessName,[response]);return status!==!1};z4m.form.events.handleTogglePassword=function(){$('body').on('click.z4m_form_password','a.zdk-toggle-password',function(event){var passwordInput=$(this).prev('input'),inputType=passwordInput.attr('type');if(inputType==='password'){passwordInput.attr('type','text');$(this).children('i').removeClass(z4m.form.hidePwdIcon).addClass(z4m.form.revealPwdIcon)}else if(inputType==='text'){passwordInput.attr('type','password');$(this).children('i').removeClass(z4m.form.revealPwdIcon).addClass(z4m.form.hidePwdIcon)}
event.preventDefault()})};z4m.action.registerView=function(viewId,options){if(options===null||typeof options!=='object'){z4m.log.error("The 'options' parameter is not an object!")}
var $this=this,isOptionOk=!1;$.each(options,function(button,properties){if(!$this.buttons.hasOwnProperty(button)||!properties.hasOwnProperty('isVisible')||typeof properties.isVisible!=='boolean'){isOptionOk=!1;return!1}
isOptionOk=!0});if(isOptionOk===!1){z4m.log.error("The 'option' properties are invalid!");return!1}
if(z4m.content.doesViewExistInDom(viewId)){if(!$this.views.hasOwnProperty(viewId)){$this.views[viewId]={}}
$.each(options,function(button,properties){$this.views[viewId][button]=properties});return!0}
z4m.log.error("The view '"+viewId+"' does not exist in the DOM!");return!1};z4m.action.setScrollUpButtonForView=function(viewId){return this.registerView(viewId,{scrollup:{isVisible:!0,callback:function(){$("html, body").animate({scrollTop:0},'fast')}}})};z4m.action.toggle=function(){var $this=this,viewId=z4m.content.getDisplayedViewId();if(viewId===null){return!1}
if(!this.views.hasOwnProperty(viewId)){this.hide();return!1}
var footerHeight=z4m.footer.getHeight(),verticalPos=footerHeight-10;$.each(this.buttons,function(button,properties){if($this.views[viewId].hasOwnProperty(button)&&$this.views[viewId][button].isVisible){$(properties.id).css({bottom:verticalPos,right:5});verticalPos+=$this.buttonGap;$($this.buttons[button].id).removeClass(z4m.hideClass)}else{$($this.buttons[button].id).addClass(z4m.hideClass)}});return!0};z4m.action.hide=function(){$.each(this.buttons,function(){var buttonId=this.id;$(buttonId).addClass(z4m.hideClass)})};z4m.action.adjustPosition=function(){return this.toggle()};z4m.action.addCustomButton=function(name,iconCssClass,colorCssClass,title){if(name.indexOf(' ')>-1){z4m.log.error("Space characters are not allowed in the button name: '"+name+"'!");return!1}
if(this.buttons.hasOwnProperty(name)){z4m.log.error("The '"+name+"' button name already exists!");return!1}
var buttonIdPrefix='zdk-mobile-action-custom-',buttonIdSuffix=1,buttonId='';while($('#'+buttonIdPrefix+buttonIdSuffix).length>0){buttonIdSuffix++}
buttonId=buttonIdPrefix+buttonIdSuffix;const buttonTitle=typeof title==='string'?title:name;const newEl=$(this.buttonTemplateId).contents().filter('a').clone();newEl.attr('id',buttonId).attr('aria-label',buttonTitle).addClass([name,colorCssClass]);newEl.find('.icon').addClass(iconCssClass).attr('title',buttonTitle);$('#zdk-mobile-action-search').after(newEl);this.buttons[name]={id:'#'+buttonId};return!0};z4m.action.removeCustomButton=function(name){const buttonEl=$('.zdk-mobile-action.'+name),viewsFound=[],$this=this;if(buttonEl.length===0){z4m.log.error("The button named '"+name+"' does not exist in the DOM!");return!1}
if(buttonEl.attr('id').indexOf('zdk-mobile-action-custom-')===-1){z4m.log.error("The button named '"+name+"' is not a custom button!");return!1}
if(!this.buttons.hasOwnProperty(name)){z4m.log.error("The button named '"+name+"' is unknown!");return!1}
$.each(this.views,function(view){$.each($this.views[view],function(button){if(button===name){viewsFound.push(view)}})});$.each(viewsFound,function(){delete $this.views[this][name]});buttonEl.remove();delete this.buttons[name];return!0};z4m.action.events.handleClick=function(){$('body').on('click.z4m_action','a.zdk-mobile-action',function(event){event.preventDefault();var viewId=z4m.content.getDisplayedViewId();if(viewId===null){z4m.log.error("Unable to identify the ID of the currently displayed view.");return!1}
if(!z4m.action.views.hasOwnProperty(viewId)){z4m.log.error("The view ID='"+viewId+"' is not registered.");return!1}
var buttonId='#'+$(this).attr('id'),buttonKey=null;$.each(z4m.action.buttons,function(key,properties){if(properties.id===buttonId){buttonKey=key;return!1}});if(buttonKey===null){z4m.log.error("No action button definition found for the ID='"+buttonId+"'!");return!1}
if(!z4m.action.views[viewId][buttonKey].hasOwnProperty('callback')){z4m.log.error("No callback function set for the '"+buttonKey+"' button of the view ID='"+viewId+"'.");return!1}
z4m.action.views[viewId][buttonKey].callback()})};z4m.list.make=function(listElementId,refresh,search){if(typeof listElementId!=='string'){z4m.log.error('List element ID is not a string!');return null}
if($(listElementId).length!==1){z4m.log.error('List element is empty!');return null}
if(!$(listElementId).is('ul')){z4m.log.error('Not a List!',$(listElementId));return null}
const listObjectProperty='znetdk4mobileListObject';if($(listElementId)[0].hasOwnProperty(listObjectProperty)){return $(listElementId)[0][listObjectProperty]}
const listObject=Object.create(this);listObject.element=$(listElementId);var firtRows=listObject.element.children();if(firtRows.length===0){z4m.log.error('No row found within the List!',$(listElementId));return null}else if(firtRows.length>2){z4m.log.error('More than 2 rows are defined!',$(listElementId))}
if(!firtRows.first().is('li')){z4m.log.error('The first row element is not a list item!',firtRows.first())}
if(firtRows.length===2&&!firtRows.eq(1).is('li')){z4m.log.error('The second row element is not a list item!',firtRows.first())}
if(z4m.ajax.initControllerActionProperties('load',listObject)===!1){z4m.log.error("The 'data-zdk-load' attribute is missing!");return null}
if(firtRows.length===2){listObject.noRowMessage='<li>'+firtRows.eq(1).html()+'</li>';firtRows.eq(1).remove()}
listObject.rowTemplate=listObject.element.html();listObject.element.find('li').remove();const actionButtons={};if(search===!0||search===undefined){actionButtons.search={isVisible:!0,callback:function(){listObject.showSearchModal()}}}
if(refresh===!0||refresh===undefined){actionButtons.refresh={isVisible:!0,callback:function(){listObject.refresh()}}}
const listViewId=z4m.content.getParentViewId(listObject.element);if(actionButtons.hasOwnProperty('search')||actionButtons.hasOwnProperty('refresh')){z4m.action.registerView(listViewId,actionButtons)}
addTagFromLocalStorage();const isFirst=listObject.element[0]===listObject.element.closest('.zdk-view').find('ul[data-zdk-load]')[0];if(!z4m.navigation.isPageToBeReloaded()&&isFirst){const afterViewDisplayEventName=z4m.navigation.events.afterViewDisplayName+'.z4m_list_'+listViewId;$('body').off(afterViewDisplayEventName);$('body').on(afterViewDisplayEventName,function(event,viewId){if(listViewId===viewId){listObject.refresh()}})}
if(search===!0||search===undefined){listObject.element.parent().on('click.z4m_list','.search-filter-container .remove',function(){var searchTag=$(this).closest('.search-tag'),filterContainer=$(this).closest('.search-filter-container');clearTagIntoLocalStorage(searchTag);searchTag.remove();if(filterContainer.is(':empty')){filterContainer.remove()}
listObject.refresh()})}
listObject.isAutocompleteOnSearchEnabled=z4m.ajax.initControllerActionProperties('autocomplete',listObject);listObject.element[0][listObjectProperty]=listObject;if(z4m.navigation.isPageToBeReloaded()){listObject.refresh()}
return listObject;function addTagFromLocalStorage(){var listId=listObject.element.attr('id'),viewId=z4m.content.getParentViewId(listObject.element),storageKeySuffix='_'+listId+'_'+viewId,sortField=z4m.browser.readLocalData(listObject.sortFieldStorageKey+storageKeySuffix),sortOrder=z4m.browser.readLocalData(listObject.sortOrderStorageKey+storageKeySuffix),sortLabel=z4m.browser.readLocalData(listObject.sortLabelStorageKey+storageKeySuffix),keywords=z4m.browser.readLocalData(listObject.keywordsStorageKey+storageKeySuffix);if(keywords!==!1){var keywordsAsArray=keywords.split('&&');keywordsAsArray.forEach(function(keyword){listObject.applyFilterAndSortCriterium(keyword,null,null,null,!0)})}
if(sortField!==!1&&sortOrder!==!1&&sortLabel!==!1){listObject.applyFilterAndSortCriterium('',sortField,sortOrder,sortLabel,!0)}}
function clearTagIntoLocalStorage(searchTag){var listId=listObject.element.attr('id'),viewId=z4m.content.getParentViewId(listObject.element),storageKeySuffix='_'+listId+'_'+viewId;if(searchTag.is('.filter-sort-criterium')){z4m.browser.removeLocalData(listObject.sortFieldStorageKey+storageKeySuffix);z4m.browser.removeLocalData(listObject.sortOrderStorageKey+storageKeySuffix);z4m.browser.removeLocalData(listObject.sortLabelStorageKey+storageKeySuffix)}else if(searchTag.is('.search-filter')){var doRemoveFilterTag=!0;if(listObject.uniqueSearchedKeyword!==!0){var storedKeywords=z4m.browser.readLocalData(listObject.keywordsStorageKey+storageKeySuffix);if(storedKeywords===!1){return}
var keywordsAsArray=storedKeywords.split('&&'),keywordToClear=searchTag.find('.filter-value').text(),keywordWithJsonDataToClear='[['+searchTag.attr('data-filter-jsondata')+']]'+keywordToClear,newStoredKeywords='';keywordsAsArray.forEach(function(keyword){if(keyword!==keywordToClear&&keyword!==keywordWithJsonDataToClear){newStoredKeywords+=newStoredKeywords===''?keyword:'&&'+keyword}});if(newStoredKeywords!==''){z4m.browser.storeLocalData(listObject.keywordsStorageKey+storageKeySuffix,newStoredKeywords);doRemoveFilterTag=!1}}
if(doRemoveFilterTag){z4m.browser.removeLocalData(listObject.keywordsStorageKey+storageKeySuffix)}}}};z4m.list.setNextPageToLoad=function(pageNumber){if(this.element instanceof jQuery===!1){z4m.log.error('List is not instantiated!');return!1}
this.element.data('page',pageNumber);return!0};z4m.list.getNextPageToLoad=function(){if(this.element instanceof jQuery===!1){z4m.log.error('List is not instantiated!');return!1}
return parseInt(this.element.data('page'))};z4m.list.setLastDocumentHeight=function(documentHeight){if(this.element instanceof jQuery===!1){z4m.log.error('List is not instantiated!');return!1}
this.element.data('height',documentHeight);return!0};z4m.list.getLastDocumentHeight=function(){if(this.element instanceof jQuery===!1){z4m.log.error('List is not instantiated!');return!1}
return parseFloat(this.element.data('height'))};z4m.list.setTotalRowCount=function(rowCount){if(this.element instanceof jQuery===!1){z4m.log.error('List is not instantiated!');return!1}
this.element.data('total',rowCount);return!0};z4m.list.getTotalRowCount=function(){if(this.element instanceof jQuery===!1){z4m.log.error('List is not instantiated!');return!1}
return parseInt(this.element.data('total'))};z4m.list.applyFilterAndSortCriterium=function(filterValue,sortfield,sortorder,sortlabel,noRefresh){if(this.element instanceof jQuery===!1){z4m.log.error('List is not instantiated!');return!1}
var isSortCriteriumToApply=sortfield!==null&&sortfield!=='_default'&&(sortfield!==this.defaultCustomSortCriterium||sortorder!=='1'),filterContainer=this.element.parent().children('.search-filter-container');filterContainer.find('.filter-sort-criterium').remove();if(this.uniqueSearchedKeyword===!0){filterContainer.find('.search-filter').remove()}
if(filterValue!==''||isSortCriteriumToApply){if(filterContainer.length===0){filterContainer=$(this.searchModalId).find('.search-filter-container').clone();filterContainer.removeClass(z4m.hideClass);filterContainer.prependTo(this.element.parent())}
if(filterValue!==''){var filterElement=$(this.searchModalId).find('.search-filter').clone();filterElement.find('.filter-value').text(getFilterValueLabel());filterElement.attr('data-filter-jsondata',getFilterValueJsonData());filterElement.attr('data-filter-key','keyword');filterElement.appendTo(filterContainer);filterElement.removeClass(z4m.hideClass)}
if(isSortCriteriumToApply){var orderClass=sortorder==='1'?'asc':'desc',sortElement=$(this.searchModalId).find('.filter-sort-criterium.'+orderClass).clone();sortElement.find('.label').text(sortlabel===undefined?this.customSortCriteria[sortfield]:sortlabel);sortElement.attr('data-sortfield',sortfield);sortElement.attr('data-sortorder',sortorder);sortElement.appendTo(filterContainer);sortElement.removeClass(z4m.hideClass)}
if(noRefresh===!0){return!0}else{addFiltersToLocalStorage(this);return this.refresh()}}
return!1;function getFilterValueLabel(){var endDataSeparatorPos=filterValue.indexOf(']]');if(endDataSeparatorPos===-1){return filterValue}
return filterValue.substring(endDataSeparatorPos+2)}
function getFilterValueJsonData(){var startDataSeparatorPos=filterValue.indexOf('[['),endDataSeparatorPos=filterValue.indexOf(']]');if(startDataSeparatorPos===-1||endDataSeparatorPos===-1){return{label:filterValue}}
return filterValue.substring(startDataSeparatorPos+2,endDataSeparatorPos)}
function addFiltersToLocalStorage(listContext){var listId=listContext.element.attr('id'),viewId=z4m.content.getParentViewId(listContext.element),storageKeySuffix='_'+listId+'_'+viewId;if(isSortCriteriumToApply){var sortTag=listContext.element.parent().find('.filter-sort-criterium'),sortLabel=sortTag.find('span.label').text();z4m.browser.storeLocalData(listContext.sortFieldStorageKey+storageKeySuffix,sortfield);z4m.browser.storeLocalData(listContext.sortOrderStorageKey+storageKeySuffix,sortorder);z4m.browser.storeLocalData(listContext.sortLabelStorageKey+storageKeySuffix,sortLabel)}
if(filterValue!==''){var keywords=filterValue;if(listContext.uniqueSearchedKeyword===!1){var storedKeywords=z4m.browser.readLocalData(listContext.keywordsStorageKey+storageKeySuffix);if(storedKeywords!==!1){keywords=storedKeywords+'&&'+filterValue}}
z4m.browser.storeLocalData(listContext.keywordsStorageKey+storageKeySuffix,keywords)}}};z4m.list.refresh=function(){if(this.element instanceof jQuery===!1){z4m.log.error('List is not instantiated!');return!1}
this.element.removeClass(z4m.hideClass);this.setNextPageToLoad(1);this.setTotalRowCount(this.rowsPerPage);this.setLastDocumentHeight(0);this.loadNewDataPage();return!0};z4m.list.loadNewDataPage=function(){if(this.element instanceof jQuery===!1){z4m.log.error('List is not instantiated!');return!1}
if(this.remoteActions.load.controller===null||this.remoteActions.load.action===null){z4m.log.error('Controller or action property not set!');return!1}
var $this=this,nextPage=this.getNextPageToLoad(),first=(nextPage-1)*this.rowsPerPage,requestData={first:first,count:this.rowsPerPage};if(first>=this.getTotalRowCount()){return!1}
var eventName=this.events.onContentScrollName+'.z4m_list';if(nextPage===1){this.element.off(eventName)}
addFiltersToRequestData.call(this,requestData);z4m.ajax.request({control:this.remoteActions.load.controller,action:this.remoteActions.load.action,data:requestData,callback:function(response){if(!response.hasOwnProperty('rows')||!response.hasOwnProperty('total')){console.error('z4m.list.loadNewDataPage(): invalid AJAX response.');return}
if(nextPage===1){$this.element.find('li').remove();removeShowNextRowsLink()}
if(response.rows.length>0){$this.setTotalRowCount(response.total);$this.setNextPageToLoad(nextPage+1);$.each(response.rows,function(){var rowData=$(this)[0];if(typeof $this.beforeInsertRowCallback==='function'){$this.beforeInsertRowCallback.call($this,rowData)}
var newRowEl=appendRow(rowData);if(typeof $this.afterInsertRowCallback==='function'){$this.afterInsertRowCallback.call($this,newRowEl)}});if(nextPage===1&&response.total>$this.rowsPerPage){handleScrollEvents();addShowNextRowsLink()}else if(response.total<=$this.element.find('li').length){removeShowNextRowsLink()}}else if(nextPage===1){$this.element.append($this.noRowMessage)}
if($this.displayRowCountInMenuTab){z4m.navigation.addRowCountToHorizontalMenuItem(response.total,z4m.content.getParentViewId($this.element))}
if(typeof $this.loadedCallback==='function'){$this.loadedCallback.call($this,response.rows.length,nextPage)}
$this.element.trigger(z4m.list.events.afterPageLoadedName,[$this,response.rows.length,nextPage]);function appendRow(rowData){var newRowAsHtml=$this.rowTemplate;$.each(rowData,function(key,value){var toReplace='{{'+key+'}}';newRowAsHtml=newRowAsHtml.replace(new RegExp(toReplace,'g'),value)});var newRowAsElement=$(newRowAsHtml);$this.element.append(newRowAsElement);return newRowAsElement}
function handleScrollEvents(){if($this.infiniteScroll){$this.element.on(eventName,function(){var windowHeight=$(window).height(),documentHeight=$(document).height(),scrollBarPosition=$(window).scrollTop(),newPageLevel=windowHeight+scrollBarPosition+$this.heightDiffForNewPage,lastDocumentHeight=$this.getLastDocumentHeight();if(newPageLevel>documentHeight&&lastDocumentHeight<documentHeight){$this.loadNewDataPage();$this.setLastDocumentHeight(documentHeight)}})}}
function addShowNextRowsLink(){const newEl=$($this.nextRowsLinkTemplateId).contents().filter('div').clone();$this.element.after(newEl);newEl.find('a').on('click.z4m_list',function(event){event.preventDefault();let docHeight=$(document).height();$this.loadNewDataPage();$this.setLastDocumentHeight(docHeight)})}
function removeShowNextRowsLink(){const linkContainer=$this.element.next('.show-next-rows');if(linkContainer.length===1){linkContainer.find('a').off('click.z4m_list');linkContainer.remove()}}}});return!0;function addFiltersToRequestData(requestData){var $this=this,filters=this.element.parent().find('.search-filter');filters.each(function(){var filterKey=$(this).data('filter-key'),filterJsonData=$(this).data('filter-jsondata'),filterValue=$(this).find('.filter-value').text();if(requestData.hasOwnProperty(filterKey)){requestData[filterKey].push(filterValue)}else{requestData[filterKey]=[filterValue]}
if($this.searchedKeywordAsJson&&typeof filterJsonData==='object'){if(requestData.hasOwnProperty(filterKey+'_json')){requestData[filterKey+'_json'].push(JSON.stringify(filterJsonData))}else{requestData[filterKey+'_json']=[JSON.stringify(filterJsonData)]}}});var sortCriterium=this.element.parent().find('.filter-sort-criterium');if(sortCriterium.length===1){requestData.sortfield=sortCriterium.data('sortfield');requestData.sortorder=sortCriterium.data('sortorder')}
if(typeof this.beforeSearchRequestCallback==='function'){this.beforeSearchRequestCallback(requestData)}}};z4m.list.setModal=function(modalElementId,isFormModifiable,onAdd,onEdit){if(this.element instanceof jQuery===!1){z4m.log.error('List is not instantiated!');return!1}
var $this=this,isModifiable=isFormModifiable===!0||isFormModifiable===undefined;if(onAdd!==!1){z4m.action.registerView(z4m.content.getParentViewId(this.element),{add:{isVisible:isModifiable,callback:function(){var modal=z4m.modal.make(modalElementId),innerForm=modal.getInnerForm();innerForm.reset();openModal(modal,innerForm,onAdd)}}})}
var eventName=this.events.afterClickEditButtonName+'.z4m_list';this.element.off(eventName);this.element.on(eventName,function(event,rowId){var modal=z4m.modal.make(modalElementId),innerForm=modal.getInnerForm();innerForm.load(rowId,function(response){if(!isModifiable){innerForm.setReadOnly()}
openModal(modal,innerForm,onEdit,response)})});return!0;function openModal(modalObj,formObj,beforeOpenCallback,formData){if(typeof beforeOpenCallback==='function'&&beforeOpenCallback.call(modalObj,formObj,formData)===!1){return}
modalObj.open(function(submitResponse){if(submitResponse.hasOwnProperty('success')&&submitResponse.success===!1){return}
$this.refresh()})}};z4m.list.showSearchModal=function(){if(this.element instanceof jQuery===!1){z4m.log.error('List is not instantiated!');return!1}
var $this=this,modal=z4m.modal.make(this.searchModalId),innerForm=modal.getInnerForm(),captionEl=$(this.searchModalId).find('label .caption'),keywordInput=$(this.searchModalId).find('input[name=keyword]'),sortInputs=$(this.searchModalId).find('.sort-criterium'),sortDropdown=sortInputs.find('select[name=sortfield]');keywordInput.prop('required',!0);captionEl.html(typeof this.searchKeywordCaption==='string'?this.searchKeywordCaption:'');if(this.isAutocompleteOnSearchEnabled){keywordInput.removeData('item');const searchAutocomplete=z4m.autocomplete.make(this.searchModalId+' input[name=keyword]',{controller:this.remoteActions.autocomplete.controller,action:this.remoteActions.autocomplete.action},onSuggestionSelected);searchAutocomplete.minStringLength=this.searchKeywordMinStringLengh}else{keywordInput.attr('autocomplete','on')}
sortDropdown.empty();sortInputs.addClass(z4m.hideClass);if(this.customSortCriteria!==null&&typeof this.customSortCriteria==='object'){for(var criterium in this.customSortCriteria){sortDropdown.append('<option value="'+criterium+'">'+this.customSortCriteria[criterium]+'</option>')}
sortInputs.removeClass(z4m.hideClass);keywordInput.prop('required',!1)}
innerForm.reset();setCurrentSortCriteriumInForm();modal.open();$(this.searchModalId+' form').off('submit.zdkmobile_list');$(this.searchModalId+' form').on('submit.zdkmobile_list',function(event){var keyword=innerForm.getInputValue('keyword'),sortfield=innerForm.getInputValue('sortfield'),sortorder=innerForm.getInputValue('sortorder');if(keyword!==''&&$this.searchedKeywordAsJson){var keywordItemData=keywordInput.data('item');if(typeof keywordItemData==='object'){keyword='[['+JSON.stringify(keywordItemData)+']]'+keyword}else{keyword='[['+JSON.stringify({label:keyword})+']]'+keyword}}
$this.applyFilterAndSortCriterium(keyword,sortfield,sortorder);modal.close();event.preventDefault()});return!0;function setCurrentSortCriteriumInForm(){var sortTag=$this.element.parent().find('.filter-sort-criterium');if(sortTag.length!==1){return!1}
var sortfield=sortTag.data('sortfield'),sortorder=sortTag.data('sortorder');innerForm.setInputValue('sortfield',sortfield);innerForm.setInputValue('sortorder',sortorder);return!0};function onSuggestionSelected(item){if($this.searchedKeywordAsJson){var storedItem={};for(var property in item){if(item.hasOwnProperty(property)&&property!=='label'){storedItem[property]=item[property]}}
if(Object.keys(storedItem).length>0){$(this).data('item',storedItem)}else{$(this).removeData('item')}}}};z4m.list.setCustomSortCriteria=function(sortCriteria,defaultSortCriterium){if(this.element instanceof jQuery===!1){z4m.log.error('List is not instantiated!');return!1}
if(sortCriteria===null||typeof sortCriteria!=='object'){z4m.log.error('Not a JS object!');return!1}
if(Object.keys(sortCriteria).length===0){z4m.log.error('The sort criteria value object is empty!');return!1}
this.customSortCriteria=sortCriteria;if(typeof defaultSortCriterium==='string'){if(sortCriteria.hasOwnProperty(defaultSortCriterium)){this.defaultCustomSortCriterium=defaultSortCriterium}else{z4m.log.error('The default sort criterium does not match any sort criteria!');return!1}}
return!0};z4m.list.events.handleEdit=function(){var $this=this,eventName='click.z4m_list';z4m.content.getContainer().on(eventName,'ul[data-zdk-load] a.edit',function(event){var listElement=$(this).closest('ul'),rowElement=$(this).closest('li'),rowId=rowElement.data('id');if(rowId===undefined){z4m.log.warn("The 'data-id' attribute is missing!");return!1}
listElement.triggerHandler($this.afterClickEditButtonName,[rowId]);event.preventDefault()})};z4m.list.events.handleScroll=function(){var $this=this,eventName='scroll.z4m_list';$(window).on(eventName,function(){var displayedView=z4m.content.getDisplayedView();if(displayedView.length!==1){return!1}
var listElement=displayedView.find('ul[data-zdk-load]');if(listElement.length===0){return!1}
listElement.eq(0).triggerHandler($this.onContentScrollName)})};z4m.autocomplete.make=function(inputElementSelector,controllerAction,onSelect,renderCallback){var inputElement=inputElementSelector instanceof jQuery?inputElementSelector:$(inputElementSelector);if(inputElement.length!==1){z4m.log.error('Autocomplete element is empty or multiple!');return null}
if(!inputElement.is('input')){z4m.log.error('Must be an input element!',inputElement);return null}
if(inputElement.attr('type')!=='search'){z4m.log.error("The input type must be 'search'!",inputElement);return null}
if(controllerAction===undefined){z4m.log.error("The controller action is missing!");return null}
if(controllerAction===null||typeof controllerAction!=='object'){z4m.log.error("The controller action must be an object!",controllerAction);return null}
if(!controllerAction.hasOwnProperty('controller')){z4m.log.error("The property 'controller' is missing!",controllerAction);return null}
if(!controllerAction.hasOwnProperty('action')){z4m.log.error("The property 'action' is missing!",controllerAction);return null}
inputElement.attr('autocomplete','off');var autocompleteObject=Object.create(this);autocompleteObject.element=inputElement;autocompleteObject.remoteActions={autocomplete:{controller:controllerAction.controller,action:controllerAction.action}};var list=autocompleteObject.element.next('ul.autocomplete'),timeout=null;if(list.length===1){list.remove()}
list=$(autocompleteObject.listTemplateId).contents().filter('ul').clone();autocompleteObject.element.after(list);_registerInputEvents();_registerSelectSuggestionEvents();return autocompleteObject;function _registerInputEvents(){var eventName='input.z4m_autocomplete';autocompleteObject.element.off(eventName);autocompleteObject.element.on(eventName,function(event){var queryString=$(this).val();_removeSuggestions();if(queryString.length<autocompleteObject.minStringLength){return}
if(timeout===null){timeout=window.setTimeout(async function(){await _showSuggestions(queryString);timeout=null},autocompleteObject.delay)}})}
function _showSuggestions(queryString){return new Promise(function(resolve){if(!_isRequestRequired(queryString)||_showCachedSuggestions(queryString)){resolve();return}
z4m.ajax.request({control:controllerAction.controller,action:controllerAction.action,data:{query:queryString},callback:function(response){if(autocompleteObject.element.is(':focus')&&response.length>0){_addSuggestionsToList(response,queryString);_addToCacheData(response,queryString);list.removeClass(z4m.hideClass);_registerClickOutOfTheAutocomplete();_registerKeyboardAction()}
_setPreviousQueryString(queryString,response.length);resolve()}})})}
function _removeSuggestions(){list.empty();list.addClass(z4m.hideClass);_registerClickOutOfTheAutocomplete(!0);_registerKeyboardAction(!0)}
function _addSuggestionsToList(response,queryString){$.each(response,function(){if(this.label===undefined){z4m.log.warn("'label' property is missing in autocomplete suggestions!",this,'error');return!1}
var itemLabel=this.label,item=$(autocompleteObject.itemTemplateId).contents().filter('li').clone(),escapedQueryString=queryString.replace(/[-\/\\^$*+?.()|[\]{}]/g,'\\$&'),htmlLabel=itemLabel.replace(new RegExp(escapedQueryString,'gi'),'<strong>$&</strong>');if(typeof renderCallback==='function'){itemLabel=renderCallback(this);if(typeof itemLabel==='string'){htmlLabel=itemLabel.replace(this.label,htmlLabel)}else{z4m.log.warn("The 'renderCallback' function set for autocomplete must return a string!")}}
item.html(htmlLabel);item.data('item',this);list.append(item)})}
function _setPreviousQueryString(queryString,responseCount){autocompleteObject.prevQueryString={queryString:queryString,responseCount:responseCount}}
function _isRequestRequired(queryString){if(autocompleteObject.prevQueryString!==null&&autocompleteObject.prevQueryString.responseCount===0&&queryString.indexOf(autocompleteObject.prevQueryString.queryString)>-1){return!1}
return!0}
function _showCachedSuggestions(queryString){for(let i=0;i<autocompleteObject.itemCache.length;i++){if(autocompleteObject.itemCache[i].queryString===queryString){_addSuggestionsToList(autocompleteObject.itemCache[i].listOfItems,queryString);list.removeClass(z4m.hideClass);return!0}}
return!1}
function _addToCacheData(response,queryString){if(autocompleteObject.itemCache.length>=autocompleteObject.maxNumberOfCachedItems){autocompleteObject.itemCache.shift()}
if(autocompleteObject.maxNumberOfCachedItems>0){autocompleteObject.itemCache.push({queryString:queryString,listOfItems:response})}}
function _registerSelectSuggestionEvents(){var eventName='click.z4m_autocomplete';list.off(eventName);list.on(eventName,'li',function(){var item=$(this).data('item'),doSelection=!0;if(typeof onSelect==='function'){doSelection=onSelect.call(autocompleteObject.element,item)}
if(doSelection!==!1){autocompleteObject.element.val(item.label)}
_removeSuggestions();if(autocompleteObject.cacheLifetime==='selection'){autocompleteObject.itemCache=[]}})}
function _registerClickOutOfTheAutocomplete(unregisterOnly){var eventName='click.z4m_autocomplete_close';$(document).off(eventName);if(unregisterOnly===!0){return!1}
$(document).on(eventName,':not(.autocomplete)',function(){_removeSuggestions()});return!0}
function _registerKeyboardAction(unregisterOnly){var eventName='keydown.z4m_autocomplete';autocompleteObject.element.off(eventName);if(unregisterOnly===!0){return!1}
autocompleteObject.element.on(eventName,function(event){if(event.keyCode===40){_setItemActive('down')}else if(event.keyCode===38){_setItemActive('up')}else if(event.keyCode===13){event.preventDefault();list.find('li.'+autocompleteObject.selectedItemCssClass).click()}else if(event.keyCode===9){_removeSuggestions()}})}
function _setItemActive(direction){var selectedItem=list.find('li.'+autocompleteObject.selectedItemCssClass);if(selectedItem.length===0){list.find('li').first().addClass(autocompleteObject.selectedItemCssClass)}else if(direction==='up'){let prevItem=selectedItem.prev();selectedItem.removeClass(autocompleteObject.selectedItemCssClass);if(prevItem.length===1){prevItem.addClass(autocompleteObject.selectedItemCssClass)}else{list.find('li').last().addClass(autocompleteObject.selectedItemCssClass)}}else if(direction==='down'){let nextItem=selectedItem.next();selectedItem.removeClass(autocompleteObject.selectedItemCssClass);if(nextItem.length===1){nextItem.addClass(autocompleteObject.selectedItemCssClass)}else{list.find('li').first().addClass(autocompleteObject.selectedItemCssClass)}}}};z4m.serviceWorker.register=function(){var appUrl=(z4m.ajax.getParamsFromAjaxURL()).url.replace('index.php',''),scriptUrl=$('body').data('service-worker-url'),fullUrl=appUrl+scriptUrl;if(scriptUrl.length===0){return!1}
if('serviceWorker' in navigator){navigator.serviceWorker.register(fullUrl).then(function(){z4m.serviceWorker.isRegistered=!0},function(error){z4m.log.error("'"+fullUrl+"': "+error.message)})}else{z4m.log.warn('Service workers are not supported.');return!1}
return!0};z4m.install.isAppInstallable=function(){return this.installPrompt!==null};z4m.install.isAppInstalled=function(){if(window.navigator.standalone){return!0}
if(window.matchMedia('(display-mode: standalone)').matches){return!0}
if(z4m.browser.readLocalData(this.isInstalledStorageKey)==='yes'){return!0}
return!1};z4m.install.showInstallableMessage=function(onlyIfAutomaticDisplayEnabled){var messageEl=$(this.installMessageId);if(!this.isAppInstallable()||(z4m.navigation.isPageToBeReloaded()&&z4m.content.getPreloadedViewId()!==z4m.navigation.getFirstChildMenuItemId())||z4m.browser.readLocalData(z4m.install.noInstallStorageKey)==='yes'||(onlyIfAutomaticDisplayEnabled&&messageEl.data('autodisplay')==='no')){return!1}
messageEl.find('button').off('click.z4m_install').on('click.z4m_install',function(){if($(this).hasClass('yes')){z4m.install.installApp(z4m.install.hideInstallableMessage)}else if($(this).hasClass('no')){z4m.browser.storeLocalData(z4m.install.noInstallStorageKey,'yes');z4m.install.hideInstallableMessage()}});messageEl.removeClass(z4m.hideClass);z4m.content.setTopSpacing();return!0};z4m.install.hideInstallableMessage=function(){$(z4m.install.installMessageId).addClass(z4m.hideClass);z4m.content.setTopSpacing()};z4m.install.showInstallView=function(){z4m.modal.make(this.installModalId,this.installViewName,function(){this.open()})};z4m.install.showUninstallView=function(){z4m.modal.make(this.uninstallModalId,this.uninstallViewName,function(){this.open()})};z4m.install.installApp=function(onSuccess){if(z4m.install.installPrompt!==null){z4m.install.installPrompt.prompt();z4m.install.installPrompt.userChoice.then(function(choiceResult){if(choiceResult&&choiceResult.outcome==='accepted'){z4m.install.installPrompt=null;z4m.browser.storeLocalData(z4m.install.isInstalledStorageKey,'yes');z4m.browser.removeLocalData(z4m.install.noInstallStorageKey);if(typeof onSuccess==='function'){onSuccess.call(z4m,onSuccess)}}});return!0}
return!1};z4m.install.events.handleBeforeInstallPrompt=function(){$(window).on('beforeinstallprompt.z4m_install',function(event){event.preventDefault();if(typeof event.originalEvent==='object'&&event.originalEvent instanceof BeforeInstallPromptEvent&&typeof event.originalEvent.prompt==='function'){z4m.install.installPrompt=event.originalEvent;z4m.browser.removeLocalData(z4m.install.isInstalledStorageKey);z4m.install.showInstallableMessage(!0)}})};z4m.file.display=function(url){z4m.ajax.request({controller:'security',action:'isconnected'});var link=document.createElement("a");link.href=url;link.rel='noopener';link.target='_blank';document.body.appendChild(link);link.click();document.body.removeChild(link)}})(jQuery,z4m)